import{q as se,t as a,w as d,H as Le,A as n,d as Re,I as Te,z as ie,j as c,J as D,F as P,b as g,S as K}from"./web-33ITdciV.js";var Ce=d("<div id=editor><ul role=menu-bar><li role=menu-item tabindex=0 aria-haspopup=true>File<ul role=menu><li role=menu-item><button>Save Source</button></li><li role=menu-item><button>Save Build</button></li><li role=menu-item><button>Load</button></li></ul></li><li role=menu-item tabindex=1 aria-haspopup=true>Test<ul role=menu><li role=menu-item><button>Parse</button></li></ul></li><li role=menu-item tabindex=2 aria-haspopup=true>Build<ul role=menu><li role=menu-item><button>Json</button></li><li role=menu-item><button>Binary</button></li></ul></li></ul><div style=display:flex;width:100%><textarea></textarea><div class=buildOutput><pre>");function Oe(i){const e=i.editorWrapper;return(()=>{var t=a(Ce),r=t.firstChild,s=r.firstChild,l=s.nextSibling,u=l.firstChild,p=u.nextSibling,f=p.firstChild,m=f.firstChild,y=l.nextSibling,I=y.firstChild,H=I.nextSibling,A=H.firstChild,W=A.nextSibling,N=r.nextSibling,C=N.firstChild,F=C.nextSibling,G=F.firstChild;return m.$$click=()=>{e.testProgram()},Le(A,"click",e.buildProgram,!0),W.$$click=()=>{},C.$$input=j=>{e.setSource(j.currentTarget.value)},n(C,()=>e.example),n(G,()=>e.buildOutput()),Re(()=>Te(C,"value",e.source())),ie(),t})()}se(["click","input"]);var Pe=d("<details><summary>Instruction Format</summary><section><p>Every instruction has the form:</p><pre><code>KEYWORD target value</code></pre><h3>Target</h3><p>The destination written by the instruction:</p><table class=table-striped><thead><tr><th>Syntax</th><th>Meaning</th></tr></thead><tbody><tr><td>:n</td><td>Register n</td></tr><tr><td>#n</td><td>Memory cell n</td></tr></tbody></table><h3>Value</h3><p>The data written into the target:</p><table class=table-striped><thead><tr><th>Syntax</th><th>Meaning</th></tr></thead><tbody><tr><td>:n</td><td>Value from register n</td></tr><tr><td>#n</td><td>Value from memory cell n</td></tr><tr><td>n</td><td>Immediate literal</td></tr><tr><td>@expr &lt;expr&gt;</td><td>Expression evaluated at assembly time; result used as an immediate value</td></tr></tbody></table><p>Values without <code>:</code>, <code>#</code>, or <code>@expr</code> are treated as immediate integers.");function Ae(){return a(Pe)}const Me=Object.freeze(Object.defineProperty({__proto__:null,default:Ae},Symbol.toStringTag,{value:"Module"}));var De=d(`<details><summary>LD — Load</summary><section><pre><code>LD target value</code></pre><p>Writes the given value into the target register or memory cell.</p><p><strong>Examples:</strong></p><pre><code>
LD :1 10            ; Immediate 10 → R1
LD #3 :1            ; R1 → Memory 3
LD :0 #7            ; Memory 7 → R0
LD :4 @expr 12 + 8  ; Immediate 20 → R4`);function Ie(){return a(De)}const Ne=Object.freeze(Object.defineProperty({__proto__:null,default:Ie},Symbol.toStringTag,{value:"Module"}));var Fe=d("<details><summary>JP — Jump</summary><section><pre><code>JP @label name;</code></pre><p>Unconditional jump to the instruction at a label.</p><p>Labels are declared using:</p><pre><code>@label name;</code></pre><p>Labels refer to instruction addresses.");function je(){return a(Fe)}const Je=Object.freeze(Object.defineProperty({__proto__:null,default:je},Symbol.toStringTag,{value:"Module"}));var ze=d(`<details><summary>Example Program Explained</summary><section><h3>start</h3><pre><code>
@label start;
LD :1 0
LD #110 :1
LD #97 :1
LD #108 :1</code></pre><p>This example loads:</p><ul><li>Immediate 0 → R1</li><li>R1 → Memory 110</li><li>R1 → Memory 97</li><li>R1 → Memory 108</li></ul><h3>blink</h3><pre><code>
@label blink;
LD :1 @expr 30 + 1  ; Immediate 31 → R1
LD #110 :1           ; R1 → Memory 110
LD :1 1              ; Immediate 1 → R1
LD #108 :1           ; R1 → Memory 108
LD :1 0              ; Immediate 0 → R1
LD #108 :1           ; R1 → Memory 108
JP @label blink;     ; Jump back to blink</code></pre><p>This section blinks a pixel by repeatedly setting the Video Control Byte to 0x1/0x0</p><p>Except for the expression-based load, all values written to <code>:1</code> are immediates or copied to memory as shown.`);function Ke(){return a(ze)}const Ue=Object.freeze(Object.defineProperty({__proto__:null,default:Ke},Symbol.toStringTag,{value:"Module"}));var Be=d("<div>");function Ve(){const e=Object.values(Object.assign({"./references/0_Format.jsx":Me,"./references/1_Load.jsx":Ne,"./references/2_Jump.jsx":Je,"./references/3_ExampleProg.jsx":Ue})).map(t=>t.default);return(()=>{var t=a(Be);return n(t,c(D,{each:e,children:r=>c(r,{})})),t})()}var He=d('<div class=hlx-header><div class=hlx-title><p class=hlx-title-text>HelixAsm</p><a href=https://github.com/NullRoz007/HelixAsm/tree/main><i class="nes-icon github"></i></a></div><p class=hlx-desc>The Helix Assembly Language is an assembly language designed to make producing code for my custom 8bit Minecraft CPU easier.');function We(){return a(He)}const Ge=["INT","OP","REG","MEM","EOF","KWD","LBL","ESR","ROUTE"],Xe=["CL","LD","PP","PO","JZ","JP","RT","RI","AD","SB","AN","OR","NO","XO","SL","SR"],ue=i=>{let e=parseInt(i);return!isNaN(e)&&Number.isInteger(e)};class Ye{constructor(e){this.expression=e.replaceAll(" ",""),this.pos=0}advance(){this.pos+=1}getNextToken(){if(this.pos>=this.expression.length)return new v("EOF",null);let e=this.expression[this.pos];if(ue(e)){let t="";for(;ue(e);)t+=e,this.advance(),e=this.expression[this.pos];return new v("INT",parseInt(t))}return this.advance(),new v("OP",e)}tokenize(){let e=[],t=this.getNextToken();for(;t.type!=="EOF";)e.push(t),t=this.getNextToken();return e.push(new v("EOF",null)),e}}class qe{constructor(e){this.tokens=e,this.pos=0,this.precedence={"+":10,"-":10,"*":20,"/":20}}peek(){return this.tokens[this.pos]}next(){return this.tokens[this.pos++]}lbp(e){return e.type=="OP"&&this.precedence[e.value]||0}nud(e){if(e.type=="INT")return{type:"atom",value:e.value};if(e.type=="OP"&&e.value=="("){let t=this.parseExpression(0);return this.next(),t}throw new Error("Unexpected token in nud: "+e.value)}led(e,t){if(t.type=="OP"){let r=this.parseExpression(this.lbp(t));return{type:"expr",op:t.value,left:e,right:r}}throw new Error("Unexpected token in led: "+t.value)}parseExpression(e=0){let t=this.next(),r=this.nud(t);for(;e<this.lbp(this.peek());){let s=this.next();r=this.led(r,s)}return r}parse(){return this.parseExpression(0)}}const re=i=>{if(i.type=="atom")return i.value;if(i.type=="expr"){let e=re(i.left),t=re(i.right);switch(i.op){case"+":return e+t;case"-":return e-t;case"*":return e*t;case"/":return e/t;default:throw new Error("Error evalulating AST!")}}},Ze=i=>{const t=new Ye(i).tokenize(),s=new qe(t).parse();return re(s)},de=50,Z=i=>{let e=parseInt(i);return!isNaN(e)&&Number.isInteger(e)},Qe=i=>"@abcdefghijklmnopqrstuvwxyz".indexOf(i.toLowerCase())!=-1;class v{constructor(e=null,t=null){this.type=e,this.value=t}}class ce{constructor(e){this.src=e.trim(),this.tokens={},this.keywords=Xe,this.pos=0,this.expressions=[],this.subroutines={};for(let t of Ge)this.tokens[t]=r=>new v(t,r)}getAddress(){let e="",t=this.src[this.pos+1];for(;Z(t);)e+=t,this.advance(),t=this.src[this.pos+1];return parseInt(e)}getMacro(){let e="",t=this.src[this.pos+1],r=de,s=0;for(;t!=";";)if(e+=t,this.advance(),t=this.src[this.pos+1],s++,s>r)throw new Error(`Max expression length (${de}) exceeded. Did you forget a ';'?
${e}`);return e}getSubroutine(){let e=new v,t=[];for(;e.type!="ESR"&&(e=this.getNextToken(),!!e);)e.type!=null&&t.push(e);return t.splice(0,t.length-1)}getLabel(e){return this.labels.map(t=>t.name==e)[0]||null}advance(e=1){this.pos+=e}getNextToken(){let e=new v,t=this.src[this.pos];if(t==" "||t==`
`)return this.advance(),e;if(this.pos>this.src.length-1)e=this.tokens.EOF(null);else if(Z(t)){let r="";for(;Z(t);)r+=t,t=this.src[this.pos+1],this.advance();e=this.tokens.INT(parseInt(r))}else if(t==":"||t=="#"){let r=this.getAddress();e=t==":"?this.tokens.REG(r):this.tokens.MEM(r)}else if(t=="@"){let r="";for(;Qe(t)&&(t=this.src[this.pos+1],!(t==" "||t==";"));)r+=t,this.advance();const s=this.getMacro().trim();switch(r){case"expr":let l=Ze(s);this.expressions.push({expr:s,value:l}),e=this.tokens.INT(l);break;case"label":e=this.tokens.LBL(s);break;case"start":this.advance(2);let u=this.getSubroutine();this.subroutines[s]=u;break;case"route":e=this.tokens.ROUTE(s);break;case"end":return e=this.tokens.ESR(null),e;default:throw new Error(`Unknown Macro Type: ${r}`)}this.advance(2)}else{let r="";for(;t!=" "&&(r+=t,!(this.pos+1>=this.src.length||(t=this.src[this.pos+1],r=="RT")));)this.advance();if(this.keywords.indexOf(r)!=-1)e=this.tokens.KWD(r);else throw e=null,new Error(`Unknown Keyword: ${r}`)}return this.advance(),e}tokenize(){let e=new v,t=[];for(;e.type!="EOF"&&(e=this.getNextToken(),!!e);)e.type!=null&&t.push(e);return t}}const Q={AD:1,SB:2,AN:3,OR:4,NO:5,XO:6,OVERRIDE:7},U={PP:0,PO:0,JZ:115,JP:255,RT:223,RI:239,SL:24,SR:20,CL:227},w=(i,e)=>{let t="";for(let r=0;r<i;r++)t+="0";return t+=e,"0b"+t.slice(-i)};class et{constructor(e,t){this.name=e,this.pos=t}}class tt{constructor(e,t,r){this.name=e,this.pos=t,this.instructions=r}}class ee{constructor(e=""){this.line=e,this.srName=null,this.memAddr=0,this.immValue=0,this.immFlag=0,this.aluCtrl=0,this.regAddr=0,this.writeFlag=0,this.clearFlag=0}setRaw(e,t){w(8,e.toString(2)),w(8,t.toString(2)),this.immValue=e,this.memAddr=e,this.immFlag=e&1,this.aluCtrl=t>>5&7,this.regAddr=t>>2&7,this.writeFlag=t>>1&1,this.clearFlag=t&1}build(){let e=0;if(e|=this.aluCtrl<<5,e|=this.regAddr<<2,e|=this.writeFlag<<1,e|=this.clearFlag,this.srName)return[w(8,this.memAddr.toString(2)),w(8,e.toString(2))];let t=(this.immFlag?this.immValue:this.memAddr)<<1|this.immFlag;return[w(8,t.toString(2)),w(8,e.toString(2))]}toString(){let e=this.build(),t=`Line:		${this.line}
Instruction:	`,r=w(7,this.immValue.toString(2)),s=w(7,this.memAddr.toString(2)),l=w(3,this.aluCtrl.toString(2)),u=w(3,this.regAddr.toString(2));return t+=this.immFlag?`Imm(${r})`:`MemAddr(${s})`,t+=`, AluCtrl(${l})`,t+=`, RegAddr(${u})`,t+=`, Flags(imm = 0b${this.immFlag}, wr = 0b${this.writeFlag}, cl = 0b${this.clearFlag})`,t+=`
Raw:		[${e[0]}, ${e[1]}]`,t}}class B{constructor(e,t){this.tokens=e,this.pos=0,this.instructions=[],this.labels=[],this.subroutines=t,this.loadedSubroutes=[]}lookAhead(e=1){let t=[],r=this.pos+1;if(this.pos+e<this.tokens.length)for(let s=0;s<e;s++){let l=this.tokens[r+s];t.push(l)}return t}advance(e=1){this.pos+=e}parseLoadKeyword(e,t,r){if(r=="INT")e.immFlag=1,e.aluCtrl=Q.OVERRIDE,e.immValue=t;else if(r=="REG")e.immFlag=0,e.regAddr=t;else if(r=="MEM")e.immFlag=0,e.memAddr=t;else throw new Error(`Unsupported valueType!"
        value:	${t}
        type: 	${r}
      `)}parseKeyword(e){let t=new ee,r=this.lookAhead(2),s=r[0].value,l=r[0].type,u=r[1].value,p=r[1].type,f=`${e.value}: `,m=null;if(l=="REG")t.regAddr=s;else if(l=="MEM")t.memAddr=s;else if(l=="LBL"){if(m=this.getLabel(s),!m)throw new Error(`Unknown label: ${s}`)}else if(l=="ROUTE"){if(!this.getSubroutine(s))throw new Error(`Unknown subroutine: ${s}`);t.srName=s}else if(l!="INT")throw new Error(`Unsupported addressType: ${l}`);if(Q[e.value]!==void 0)f+=`${l}(${s})`,t.aluCtrl=Q[e.value],this.advance();else if(U[e.value]!==void 0)f+=`${l}(${s}) - S`,l=="LBL"&&m&&(s=m.pos),t.setRaw(s,U[e.value]),this.advance();else if(e.value=="LD")f+=`${l}(${s}) <- ${p}(${u})`,this.parseLoadKeyword(t,u,p),t.writeFlag=1,this.advance(2);else throw new Error(`Unknown Keyword: '${e.value}'`);return t.line=f,t}getLabel(e){return this.labels.filter(t=>t.name==e)[0]}getSubroutine(e){return this.subroutines[e]}getNextToken(){return this.tokens[this.pos]}parse(){let e=new v,t=0;for(;e.type!="EOF"&&(e=this.getNextToken(),e!==void 0);){if(e.type=="KWD"){if(e.value=="RT"){let r=new ee;r.setRaw(0,U.RT),r.line="RT: PC <- CALLSTACK.pop()",this.instructions.push(r),this.advance(),t++;continue}if(e.value=="CL"){let r=this.parseKeyword(e);this.instructions.push(r),this.advance(),t++;continue}}switch(e.type){case"KWD":let r=this.parseKeyword(e);this.instructions.push(r),this.advance(),t++;break;case"LBL":let s=e.value;this.getLabel(s)||this.labels.push(new et(s,t)),this.advance();break;case"EOF":break;default:throw new Error(`Unknown Token Type: ${e.type}`)}}}mapSubroutines(){let t=this.instructions.length;const r=[];for(let l in this.subroutines){let u=new tt(l,t,this.subroutines[l]);t+=u.instructions.length,r.push(u)}for(let l of this.instructions)if(l.srName!==null){let u=r.filter(p=>p.name==l.srName)[0];l.memAddr=u.pos+1}let s=new ee;s.line="=== START SR_TABLE ===",s.setRaw(t,U.JP),this.instructions.push(s);for(let l of r)this.instructions.push(...l.instructions)}}const rt={IO_MAP:[],SCREEN_X:110,SCREEN_Y:96,SCREEN_CTRL:108,STACK_PTR:0,STACK_DEPTH:16};class st{constructor(e){this.instructions=e,this.output={header:rt,instructions:[],lines:[]}}async build(e){for(let r of this.instructions)console.log(r),this.output.instructions.push(r.build()),this.output.lines.push(r.toString());return JSON.stringify(this.output,null,2)}}var it=d('<div class=modal-overlay><div class="standard-dialog center scale-down"id=error-modal><div class=modal-contents><h1 class=modal-text></h1><!$><!/><section id=modal-row-btn class=field-row style=justify-content:flex-end><button class=btn>OK');function he(i){return(()=>{var e=a(it),t=e.firstChild,r=t.firstChild,s=r.firstChild,l=s.nextSibling,[u,p]=P(l.nextSibling),f=u.nextSibling,m=f.firstChild;return e.$$click=()=>i.onClose(),t.$$click=y=>y.stopPropagation(),n(s,()=>i.title),n(r,()=>i.children,u,p),m.$$click=()=>i.onClose(),ie(),e})()}se(["click"]);var lt=d("<div class=window-pane id=editor-window-pane>"),nt=d("<div class=window-pane>"),ot=d("<p>"),at=d("<details><summary>Tokens</summary><ol>"),ut=d("<details><summary>Instructions</summary><ol>"),dt=d("<details><summary>Expressions</summary><ol>"),ct=d("<details><summary>Labels</summary><ol>"),ht=d("<div><!$><!/><div class=content-wrapper><div class=window id=main-window><div class=title-bar><button aria-label=Close class=close></button><h1 class=title>Editor</h1><button aria-label=Resize class=resize></button></div><!$><!/></div><div class=window id=ref-window><div class=title-bar><button aria-label=Close class=close></button><h1 class=title>Language Reference</h1><button aria-label=Resize class=resize></button></div><!$><!/></div></div><!$><!/><!$><!/>"),V=d("<li><p>");const te=`@label start;
LD :1 0
LD #110 :1
LD #97 :1
LD #108 :1

@label blink;
LD :1 @expr 30 + 1;
LD #110 :1
LD :1 1
LD #108 :1
LD :1 0
LD #108 :1
JP @label blink;
`;function gt(){const[i,e]=g(!1),[t,r]=g(!1),[s,l]=g(!1),[u,p]=g(!1),[f,m]=g(!1),[y,I]=g(te),[H,A]=g(""),[W,N]=g([]),[C,F]=g([]),[G,j]=g([]),[pe,le]=g([]),me={buildOutput:H,source:y,setSource:I,setBuildOutput:A,setParseModalState:l,setErrorModalState:p,setErrorText:m,setReportTokens:N,setReportInstructions:F,setReportExpressions:j,setReportLabels:le,testProgram:()=>{try{const h=new ce(y()),k=h.tokenize(),E=h.subroutines;let S={};for(let _ of Object.keys(E)){let O=E[_],M=new B(O);M.parse(),S[_]=M.instructions}const $=new B(k,S);$.parse(),$.mapSubroutines(),N(k),F($.instructions),j(h.expressions),le($.labels),l(!0)}catch(h){m(h.message),p(!0)}},buildProgram:async()=>{try{const k=new ce(y()).tokenize(),E=k.tokens,S=k.subroutines;console.log(S);let $={};for(let J of Object.keys(S)){let Y=S[J],z=new B(Y);z.parse(),$[J]=z.instructions}const _=new B(E,$);_.parse(),_.mapSubroutines();const O=_.instructions,X=await new st(O).build();A(X)}catch(h){m(h.message),p(!0)}},example:te};return I(te),(()=>{var h=a(ht),k=h.firstChild,[E,S]=P(k.nextSibling),$=E.nextSibling,_=$.firstChild,O=_.firstChild,M=O.firstChild,X=M.nextSibling,J=X.nextSibling,Y=O.nextSibling,[z,be]=P(Y.nextSibling),ne=_.nextSibling,oe=ne.firstChild,ge=oe.firstChild,fe=ge.nextSibling,$e=fe.nextSibling,_e=oe.nextSibling,[xe,we]=P(_e.nextSibling),ve=$.nextSibling,[ae,Se]=P(ve.nextSibling),ye=ae.nextSibling,[ke,Ee]=P(ye.nextSibling);return n(h,c(We,{}),E,S),J.$$click=()=>e(!i()),n(_,c(K,{get when(){return i()},get children(){var o=a(lt);return n(o,c(Oe,{editorWrapper:me})),o}}),z,be),$e.$$click=()=>r(!t()),n(ne,c(K,{get when(){return t()},get children(){var o=a(nt);return n(o,c(Ve,{})),o}}),xe,we),n(h,c(K,{get when(){return u()},get children(){return c(he,{title:"Error during build!",onClose:()=>{p(!1)},get children(){var o=a(ot);return n(o,f),o}})}}),ae,Se),n(h,c(K,{get when(){return s()},get children(){return c(he,{title:"Parse Results",onClose:()=>{l(!1)},get children(){return[(()=>{var o=a(at),L=o.firstChild,R=L.nextSibling;return n(R,c(D,{get each(){return W()},children:(x,q)=>(()=>{var b=a(V),T=b.firstChild;return n(T,()=>x.type+" "+(x.value||"")),b})()})),o})(),(()=>{var o=a(ut),L=o.firstChild,R=L.nextSibling;return n(R,c(D,{get each(){return C()},children:(x,q)=>(()=>{var b=a(V),T=b.firstChild;return n(T,()=>x.toString()),b})()})),o})(),(()=>{var o=a(dt),L=o.firstChild,R=L.nextSibling;return n(R,c(D,{get each(){return G()},children:(x,q)=>(()=>{var b=a(V),T=b.firstChild;return n(T,()=>x.expr+" = "+(x.value||"??")),b})()})),o})(),(()=>{var o=a(ct),L=o.firstChild,R=L.nextSibling;return n(R,c(D,{get each(){return pe()},children:(x,q)=>(()=>{var b=a(V),T=b.firstChild;return n(T,()=>x.name+" = "+x.pos),b})()})),o})()]}})}}),ke,Ee),ie(),h})()}se(["click"]);export{gt as default};
