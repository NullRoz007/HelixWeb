import{q as G,t as o,w as u,H as ke,A as n,d as Le,I as Re,z as X,j as d,J as P,F as R,b as $,S as I}from"./web-33ITdciV.js";var Te=u("<div id=editor><ul role=menu-bar><li role=menu-item tabindex=0 aria-haspopup=true>File<ul role=menu><li role=menu-item><button>Save Source</button></li><li role=menu-item><button>Save Build</button></li><li role=menu-item><button>Load</button></li></ul></li><li role=menu-item tabindex=1 aria-haspopup=true>Test<ul role=menu><li role=menu-item><button>Parse</button></li></ul></li><li role=menu-item tabindex=2 aria-haspopup=true>Build<ul role=menu><li role=menu-item><button>Json</button></li><li role=menu-item><button>Binary</button></li></ul></li></ul><div style=display:flex;width:100%><textarea></textarea><div class=buildOutput><pre>");function Ce(s){const e=s.editorWrapper;return(()=>{var t=o(Te),r=t.firstChild,l=r.firstChild,i=l.nextSibling,p=i.firstChild,m=p.nextSibling,_=m.firstChild,h=_.firstChild,y=i.nextSibling,O=y.firstChild,N=O.nextSibling,T=N.firstChild,j=T.nextSibling,M=r.nextSibling,L=M.firstChild,A=L.nextSibling,J=A.firstChild;return h.$$click=()=>{e.testProgram()},ke(T,"click",e.buildProgram,!0),j.$$click=()=>{},L.$$input=D=>{e.setSource(D.currentTarget.value)},n(L,()=>e.example),n(J,()=>e.buildOutput()),Le(()=>Re(L,"value",e.source())),X(),t})()}G(["click","input"]);var Pe=u("<details><summary>Instruction Format</summary><section><p>Every instruction has the form:</p><pre><code>KEYWORD target value</code></pre><h3>Target</h3><p>The destination written by the instruction:</p><table class=table-striped><thead><tr><th>Syntax</th><th>Meaning</th></tr></thead><tbody><tr><td>:n</td><td>Register n</td></tr><tr><td>#n</td><td>Memory cell n</td></tr></tbody></table><h3>Value</h3><p>The data written into the target:</p><table class=table-striped><thead><tr><th>Syntax</th><th>Meaning</th></tr></thead><tbody><tr><td>:n</td><td>Value from register n</td></tr><tr><td>#n</td><td>Value from memory cell n</td></tr><tr><td>n</td><td>Immediate literal</td></tr><tr><td>@expr &lt;expr&gt;</td><td>Expression evaluated at assembly time; result used as an immediate value</td></tr></tbody></table><p>Values without <code>:</code>, <code>#</code>, or <code>@expr</code> are treated as immediate integers.");function Oe(){return o(Pe)}const Me=Object.freeze(Object.defineProperty({__proto__:null,default:Oe},Symbol.toStringTag,{value:"Module"}));var Ae=u(`<details><summary>LD — Load</summary><section><pre><code>LD target value</code></pre><p>Writes the given value into the target register or memory cell.</p><p><strong>Examples:</strong></p><pre><code>
LD :1 10            ; Immediate 10 → R1
LD #3 :1            ; R1 → Memory 3
LD :0 #7            ; Memory 7 → R0
LD :4 @expr 12 + 8  ; Immediate 20 → R4`);function De(){return o(Ae)}const Ie=Object.freeze(Object.defineProperty({__proto__:null,default:De},Symbol.toStringTag,{value:"Module"}));var Fe=u("<details><summary>JP — Jump</summary><section><pre><code>JP @label name;</code></pre><p>Unconditional jump to the instruction at a label.</p><p>Labels are declared using:</p><pre><code>@label name;</code></pre><p>Labels refer to instruction addresses.");function Ne(){return o(Fe)}const je=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));var Je=u(`<details><summary>Example Program Explained</summary><section><h3>start</h3><pre><code>
@label start;
LD :1 0
LD #110 :1
LD #97 :1
LD #108 :1</code></pre><p>This example loads:</p><ul><li>Immediate 0 → R1</li><li>R1 → Memory 110</li><li>R1 → Memory 97</li><li>R1 → Memory 108</li></ul><h3>blink</h3><pre><code>
@label blink;
LD :1 @expr 30 + 1  ; Immediate 31 → R1
LD #110 :1           ; R1 → Memory 110
LD :1 1              ; Immediate 1 → R1
LD #108 :1           ; R1 → Memory 108
LD :1 0              ; Immediate 0 → R1
LD #108 :1           ; R1 → Memory 108
JP @label blink;     ; Jump back to blink</code></pre><p>This section blinks a pixel by repeatedly setting the Video Control Byte to 0x1/0x0</p><p>Except for the expression-based load, all values written to <code>:1</code> are immediates or copied to memory as shown.`);function ze(){return o(Je)}const Ke=Object.freeze(Object.defineProperty({__proto__:null,default:ze},Symbol.toStringTag,{value:"Module"}));var Be=u("<div>");function Ue(){const e=Object.values(Object.assign({"./references/0_Format.jsx":Me,"./references/1_Load.jsx":Ie,"./references/2_Jump.jsx":je,"./references/3_ExampleProg.jsx":Ke})).map(t=>t.default);return(()=>{var t=o(Be);return n(t,d(P,{each:e,children:r=>d(r,{})})),t})()}var Ve=u('<div class=hlx-header><div class=hlx-title><p class=hlx-title-text>HelixAsm</p><a href=https://github.com/NullRoz007/HelixAsm/tree/main><i class="nes-icon github"></i></a></div><p class=hlx-desc>The Helix Assembly Language is an assembly language designed to make producing code for my custom 8bit Minecraft CPU easier.');function He(){return o(Ve)}const We=["INT","OP","REG","MEM","EOF","KWD","LBL"],Ge=["LD","PP","PO","JZ","JP","RT","RI","AD","SB","AN","OR","NO","XO","SL","SR"],te=s=>{let e=parseInt(s);return!isNaN(e)&&Number.isInteger(e)};class Xe{constructor(e){this.expression=e.replaceAll(" ",""),this.pos=0}advance(){this.pos+=1}getNextToken(){if(this.pos>=this.expression.length)return new w("EOF",null);let e=this.expression[this.pos];if(te(e)){let t="";for(;te(e);)t+=e,this.advance(),e=this.expression[this.pos];return new w("INT",parseInt(t))}return this.advance(),new w("OP",e)}tokenize(){let e=[],t=this.getNextToken();for(;t.type!=="EOF";)e.push(t),t=this.getNextToken();return e.push(new w("EOF",null)),e}}class Ye{constructor(e){this.tokens=e,this.pos=0,this.precedence={"+":10,"-":10,"*":20,"/":20}}peek(){return this.tokens[this.pos]}next(){return this.tokens[this.pos++]}lbp(e){return e.type=="OP"&&this.precedence[e.value]||0}nud(e){if(e.type=="INT")return{type:"atom",value:e.value};if(e.type=="OP"&&e.value=="("){let t=this.parseExpression(0);return this.next(),t}throw new Error("Unexpected token in nud: "+e.value)}led(e,t){if(t.type=="OP"){let r=this.parseExpression(this.lbp(t));return{type:"expr",op:t.value,left:e,right:r}}throw new Error("Unexpected token in led: "+t.value)}parseExpression(e=0){let t=this.next(),r=this.nud(t);for(;e<this.lbp(this.peek());){let l=this.next();r=this.led(r,l)}return r}parse(){return this.parseExpression(0)}}const W=s=>{if(s.type=="atom")return s.value;if(s.type=="expr"){let e=W(s.left),t=W(s.right);switch(s.op){case"+":return e+t;case"-":return e-t;case"*":return e*t;case"/":return e/t;default:throw new Error("Error evalulating AST!")}}},qe=s=>{const t=new Xe(s).tokenize(),l=new Ye(t).parse();return W(l)},re=50,U=s=>{let e=parseInt(s);return!isNaN(e)&&Number.isInteger(e)},Ze=s=>"@abcdefghijklmnopqrstuvwxyz".indexOf(s.toLowerCase())!=-1;class w{constructor(e=null,t=null){this.type=e,this.value=t}}class se{constructor(e){this.src=e.trim(),this.tokens={},this.keywords=Ge,this.pos=0,this.expressions=[];for(let t of We)this.tokens[t]=r=>new w(t,r)}getAddress(){let e="",t=this.src[this.pos+1];for(;U(t);)e+=t,this.advance(),t=this.src[this.pos+1];return parseInt(e)}getMacro(){let e="",t=this.src[this.pos+1],r=re,l=0;for(;t!=";";)if(e+=t,this.advance(),t=this.src[this.pos+1],l++,l>r)throw new Error(`Max expression length (${re}) exceeded. Did you forget a ';'?
${e}`);return e}getLabel(e){return this.labels.map(t=>t.name==e)[0]||null}advance(e=1){this.pos+=e}getNextToken(){let e=new w,t=this.src[this.pos];if(t==" "||t==`
`)return this.advance(),e;if(this.pos>this.src.length-1)e=this.tokens.EOF(null);else if(U(t)){let r="";for(;U(t);)r+=t,t=this.src[this.pos+1],this.advance();e=this.tokens.INT(parseInt(r))}else if(t==":"||t=="#"){let r=this.getAddress();e=t==":"?this.tokens.REG(r):this.tokens.MEM(r)}else if(t=="@"){let r="";for(;Ze(t)&&(t=this.src[this.pos+1],t!=" ");)r+=t,this.advance();const l=this.getMacro().trim();switch(r){case"expr":let i=qe(l);this.expressions.push({expr:l,value:i}),e=this.tokens.INT(i);break;case"label":e=this.tokens.LBL(l);break;default:throw new Error(`Unknown Macro Type: ${r}`)}this.advance(2)}else{let r="";for(;t!=" "&&(r+=t,!(this.pos+1>=this.src.length));)t=this.src[this.pos+1],this.advance();if(this.keywords.indexOf(r)!=-1)e=this.tokens.KWD(r);else throw e=null,new Error(`Unknown Keyword: ${r}`)}return this.advance(),e}tokenize(){let e=new w,t=[];for(;e.type!="EOF"&&(e=this.getNextToken(),!!e);)e.type!=null&&t.push(e);return t}}const V={AD:1,SB:2,AN:3,OR:4,NO:5,XO:6,OVERRIDE:7},le={PP:0,PO:0,JZ:115,JP:255,RT:0,RI:239,SL:24,SR:20},v=(s,e)=>{let t="";for(let r=0;r<s;r++)t+="0";return t+=e,"0b"+t.slice(-s)};class Qe{constructor(e,t){this.name=e,this.pos=t}}class et{constructor(e=""){this.line=e,this.memAddr=0,this.immValue=0,this.immFlag=0,this.aluCtrl=0,this.regAddr=0,this.writeFlag=0,this.clearFlag=0}setRaw(e,t){v(8,e.toString(2)),v(8,t.toString(2)),this.immValue=e,this.memAddr=e,this.immFlag=e&1,this.aluCtrl=t>>5&7,this.regAddr=t>>2&7,this.writeFlag=t>>1&1,this.clearFlag=t&1}build(){let e=(this.immFlag?this.immValue:this.memAddr)<<1|this.immFlag,t=0;return t|=this.aluCtrl<<5,t|=this.regAddr<<2,t|=this.writeFlag<<1,t|=this.clearFlag,[v(8,e.toString(2)),v(8,t.toString(2))]}toString(){let e=this.build(),t=`Line:		${this.line}
Instruction:	`,r=v(7,this.immValue.toString(2)),l=v(7,this.memAddr.toString(2)),i=v(3,this.aluCtrl.toString(2)),p=v(3,this.regAddr.toString(2));return t+=this.immFlag?`Imm(${r})`:`MemAddr(${l})`,t+=`, AluCtrl(${i})`,t+=`, RegAddr(${p})`,t+=`, Flags(imm = 0b${this.immFlag}, wr = 0b${this.writeFlag}, cl = 0b${this.clearFlag})`,t+=`
Raw:		[${e[0]}, ${e[1]}]`,t}}class ie{constructor(e){this.tokens=e,this.pos=0,this.instructions=[],this.labels=[]}lookAhead(e=1){let t=[],r=this.pos+1;if(this.pos+e<this.tokens.length)for(let l=0;l<e;l++){let i=this.tokens[r+l];t.push(i)}return t}advance(e=1){this.pos+=e}parseLoadKeyword(e,t,r){if(r=="INT")e.immFlag=1,e.aluCtrl=V.OVERRIDE,e.immValue=t;else if(r=="REG")e.immFlag=0,e.regAddr=t;else throw new Error(`Unsupported valueType!"
        value:	${t}
        type: 	${type}
      `)}parseKeyword(e){let t=new et,r=this.lookAhead(2),l=r[0].value,i=r[0].type,p=r[1].value,m=r[1].type,_=`${e.value}: `,h=null;if(i=="REG")t.regAddr=l;else if(i=="MEM")t.memAddr=l;else if(i=="LBL"){if(h=this.getLabel(l),!h)throw new Error(`Unknown label: ${l}`)}else if(i!="INT")throw new Error("Unsupported addressType!");if(V[e.value]!==void 0)_+=`${i}(${l})`,t.aluCtrl=V[e.value],this.advance();else if(le[e.value]!==void 0)_+=`${i}(${l}) - S`,i=="LBL"&&h&&(l=h.pos),t.setRaw(l,le[e.value]),this.advance();else if(e.value=="LD")_+=`${i}(${l}) <- ${m}(${p})`,this.parseLoadKeyword(t,p,m),t.writeFlag=1,this.advance(2);else throw new Error(`Unknown Keyword: '${e.value}'`);return t.line=_,t}getLabel(e){return this.labels.filter(t=>t.name==e)[0]}getNextToken(){return this.tokens[this.pos]}parse(){let e=new w,t=0;for(;e.type!="EOF";)switch(e=this.getNextToken(),e.type){case"KWD":let r=this.parseKeyword(e);this.instructions.push(r),this.advance(),t++;break;case"LBL":let l=e.value;this.getLabel(l)||this.labels.push(new Qe(l,t)),this.advance();break;case"EOF":break;default:throw new Error(`Unknown Token Type: ${e.type}`)}}}const tt={IO_MAP:[],SCREEN_X:110,SCREEN_Y:96,SCREEN_CTRL:108,STACK_PTR:0,STACK_DEPTH:16};class rt{constructor(e){this.instructions=e,this.output={header:tt,instructions:[],lines:[]}}async build(e){for(let r of this.instructions)this.output.instructions.push(r.build()),this.output.lines.push(r.toString());return JSON.stringify(this.output,null,2)}}var st=u('<div class=modal-overlay><div class="standard-dialog center scale-down"id=error-modal><div class=modal-contents><h1 class=modal-text></h1><!$><!/><section id=modal-row-btn class=field-row style=justify-content:flex-end><button class=btn>OK');function ne(s){return(()=>{var e=o(st),t=e.firstChild,r=t.firstChild,l=r.firstChild,i=l.nextSibling,[p,m]=R(i.nextSibling),_=p.nextSibling,h=_.firstChild;return e.$$click=()=>s.onClose(),t.$$click=y=>y.stopPropagation(),n(l,()=>s.title),n(r,()=>s.children,p,m),h.$$click=()=>s.onClose(),X(),e})()}G(["click"]);var lt=u("<div class=window-pane id=editor-window-pane>"),it=u("<div class=window-pane>"),nt=u("<p>"),at=u("<details><summary>Tokens</summary><ol>"),ot=u("<details><summary>Instructions</summary><ol>"),ut=u("<details><summary>Expressions</summary><ol>"),dt=u("<details><summary>Labels</summary><ol>"),ct=u("<div><!$><!/><div class=content-wrapper><div class=window id=main-window><div class=title-bar><button aria-label=Close class=close></button><h1 class=title>Editor</h1><button aria-label=Resize class=resize></button></div><!$><!/></div><div class=window id=ref-window><div class=title-bar><button aria-label=Close class=close></button><h1 class=title>Language Reference</h1><button aria-label=Resize class=resize></button></div><!$><!/></div></div><!$><!/><!$><!/>"),F=u("<li><p>");const H=`@label start;
LD :1 0
LD #110 :1
LD #97 :1
LD #108 :1

@label blink;
LD :1 @expr 30 + 1;
LD #110 :1
LD :1 1
LD #108 :1
LD :1 0
LD #108 :1
JP @label blink;
`;function bt(){const[s,e]=$(!1),[t,r]=$(!1),[l,i]=$(!1),[p,m]=$(!1),[_,h]=$(!1),[y,O]=$(H),[N,T]=$(""),[j,M]=$([]),[L,A]=$([]),[J,D]=$([]),[ae,Y]=$([]),oe={buildOutput:N,source:y,setSource:O,setBuildOutput:T,setParseModalState:i,setErrorModalState:m,setErrorText:h,setReportTokens:M,setReportInstructions:A,setReportExpressions:D,setReportLabels:Y,testProgram:()=>{try{const c=new se(y()),x=c.tokenize(),b=new ie(x);b.tokens=x,b.parse(),M(x),A(b.instructions),D(c.expressions),Y(b.labels),i(!0)}catch(c){h(c.message),m(!0)}},buildProgram:async()=>{try{const x=new se(y()).tokenize(),b=new ie(x);b.tokens=x,b.parse();const z=b.instructions,C=await new rt(z).build();T(C)}catch(c){h(c.message),m(!0)}},example:H};return O(H),(()=>{var c=o(ct),x=c.firstChild,[b,z]=R(x.nextSibling),K=b.nextSibling,C=K.firstChild,q=C.firstChild,ue=q.firstChild,de=ue.nextSibling,ce=de.nextSibling,he=q.nextSibling,[pe,me]=R(he.nextSibling),Z=C.nextSibling,Q=Z.firstChild,be=Q.firstChild,ge=be.nextSibling,$e=ge.nextSibling,_e=Q.nextSibling,[fe,xe]=R(_e.nextSibling),ve=K.nextSibling,[ee,we]=R(ve.nextSibling),ye=ee.nextSibling,[Se,Ee]=R(ye.nextSibling);return n(c,d(He,{}),b,z),ce.$$click=()=>e(!s()),n(C,d(I,{get when(){return s()},get children(){var a=o(lt);return n(a,d(Ce,{editorWrapper:oe})),a}}),pe,me),$e.$$click=()=>r(!t()),n(Z,d(I,{get when(){return t()},get children(){var a=o(it);return n(a,d(Ue,{})),a}}),fe,xe),n(c,d(I,{get when(){return p()},get children(){return d(ne,{title:"Error during build!",onClose:()=>{m(!1)},get children(){var a=o(nt);return n(a,_),a}})}}),ee,we),n(c,d(I,{get when(){return l()},get children(){return d(ne,{title:"Parse Results",onClose:()=>{i(!1)},get children(){return[(()=>{var a=o(at),S=a.firstChild,E=S.nextSibling;return n(E,d(P,{get each(){return j()},children:(f,B)=>(()=>{var g=o(F),k=g.firstChild;return n(k,()=>f.type+" "+(f.value||"")),g})()})),a})(),(()=>{var a=o(ot),S=a.firstChild,E=S.nextSibling;return n(E,d(P,{get each(){return L()},children:(f,B)=>(()=>{var g=o(F),k=g.firstChild;return n(k,()=>f.toString()),g})()})),a})(),(()=>{var a=o(ut),S=a.firstChild,E=S.nextSibling;return n(E,d(P,{get each(){return J()},children:(f,B)=>(()=>{var g=o(F),k=g.firstChild;return n(k,()=>f.expr+" = "+(f.value||"??")),g})()})),a})(),(()=>{var a=o(dt),S=a.firstChild,E=S.nextSibling;return n(E,d(P,{get each(){return ae()},children:(f,B)=>(()=>{var g=o(F),k=g.firstChild;return n(k,()=>f.name+" = "+f.pos),g})()})),a})()]}})}}),Se,Ee),X(),c})()}G(["click"]);export{bt as default};
